# 金蚱系统版本记录

## v1.5.1 (2025-10-06)
### 优化
- 采购库：首次开具仅填描述的明细会自动在商品库创建商品并生成编码，采购记录带上 product_code 以便后续合并。
- 聚合分组：按“编码优先，否则标准化描述”归一化分组键，避免无编码记录被拆分多行。

## v1.5.0 (2025-10-05)
### 新增
- 新增“采购库”模块：
	- 首页导航新增入口，页面展示按日期+商品的汇总：日期、商品编码、商品描述、单位、数量合计、均价（加权平均）。
	- 账套隔离查询，支持日期范围、关键词搜索。
- 后端：新增 purchase_records 表与 /api/purchases 接口；发票创建/更新/状态切换时同步入库。
- 前端：新增 `src/views/PurchaseLibrary.vue`，`App.vue` 路由与 Dashboard 入口。

## v1.4.2 (2025-10-05)
### 修复
- 发票管理切换账套后，新建发票始终落在同一账套的问题：
	- 确保后端收到正确的 account_set_id，发票号按对应账套规则生成

### 部署/后端稳健性
- Docker 运行镜像包含 routes/utils，避免生产环境 API 返回 HTML
- 服务启动时自动执行 data/migrations 下的 SQL 脚本，保证首次部署表结构可用
- Render/Railway 环境指定 Node 版本与持久化卷路径，稳定构建与运行
### 前端体验
- 去除全局右上角账套切换入口，集中在发票页；修复移除后造成的模板结构破坏
- 发票编号不再在打开表单时预生成，避免取消导致跳号；金额大写包含分(cents)


### 修复
	- 统一发票编号生成逻辑，改为使用 code_rules.current_number 并与 /api/generate-code 占位格式保持一致
	- 后端在发票号唯一约束冲突时自动重试生成，确保高并发或偶发碰撞下也能成功保存
	- 前端在保存时携带已生成的发票号，避免重复二次生成导致的冲突

### 改进
- 用户创建/更新时的账套分配与默认账套设置更加稳健，增加事务与校验
- 新增 GET /api/users/:id/account-sets，便于前端读取用户账套与默认值

### 兼容性
- 无需额外数据库迁移

## v1.4.0 (2025-10-03)

### 重要更新
- 全面优化系统UI，移除侧边栏，采用更简洁的导航方式
- 重新设计登录界面，提供更现代化的用户体验
- 修复页面加载过程中可能出现的空白问题

### 变更详情
- 完全移除所有页面的左侧固定导航栏，使用仪表盘作为主导航中心
- 美化并优化"返回主页"按钮，增强用户体验
- 重构页面布局逻辑，使所有页面采用一致的全宽样式
- 重新设计登录界面，采用左右分栏布局，提供更好的视觉体验
- 添加登录界面动效，优化表单控件的交互体验
- 修复computed导入缺失导致的页面加载问题

### 技术改进
- 优化组件结构，减少不必要的条件渲染
- 改进响应式布局，更好地支持各种屏幕尺寸
- 统一全系统页面风格，提升用户体验一致性

## v1.3.0-base (2025-10-03)

### 重要更新
- 简化用户下拉菜单，只保留登出功能
- 优化会话管理，实现会话超时后自动登出
- 系统基础模块完善，达到生产级别要求

### 变更详情
- 移除用户下拉菜单中的"个人资料"和"系统设置"菜单项
- 改进会话过期逻辑，将会话时长从24小时缩短为4小时
- 添加会话过期检测和提前警告功能，提升用户体验
- 完善系统的基础功能模块，修复已知bug

### 技术改进
- 优化前端组件结构，减少不必要的交互元素
- 增强系统安全性，避免长期会话带来的安全风险
- 前端添加定时检测会话状态功能，提供即将过期警告

## v1.2.0-base (2025-10-04)

### 重要更新
- 移除软删除和回收站功能，改为直接物理删除
- 优化系统架构，简化数据管理逻辑

### 变更详情
- 删除所有表中的 deleted_at 和 is_deleted 字段
- 移除回收站组件和对应的菜单入口
- 修改所有删除API，改为直接物理删除记录
- 移除所有恢复(restore)API端点
- 简化数据查询，移除对已删除项目的过滤

### 技术改进
- 精简代码库，移除与软删除相关的复杂逻辑
- 优化API响应结构，移除force参数
- 删除RecycleBin.vue组件及相关引用

## v1.1.0-base (2025-10-03)

### 新功能
- 商品库改为共享数据，不再绑定特定账套
- 所有账套现在可以共享同一个商品库
- 添加"通用商品数据，所有账套共享"的界面说明

### 优化
- 业务员状态从"在职/离职"更改为"启用/停用"，更符合通用场景
- 移除联系电话字段的手机号格式验证，允许自由输入
- 修正添加商品时的提示，去除"账套ID不能为空"

### 技术变更
- 删除商品表的 account_set_id 外键关联
- 重构商品库前端界面，移除账套选择器
- 优化API结构，支持全局商品数据访问

## v1.0.0-base (之前版本)

### 基础功能
- 用户管理和权限系统
- 客户管理
- 供应商管理
- 业务员管理
- 商品库管理(账套绑定)
- 账套管理及配置